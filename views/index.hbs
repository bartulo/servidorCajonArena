<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/stylesheets/inicio.css" />
  </head>
    <script src="/socket.io/socket.io.js"></script>
      <script>
        const socket = io();
        document.querySelector('body').addEventListener('click', (e) => {
          const anchor = e.target.closest('a');
          if ( anchor !== null ) {
            socket.emit('openBrowser', anchor.title);
          }
        },false);

        const escenarioActivo = function( escena, pid ) {
          let escenario = document.querySelector(`#${escena}`);
          let lineas = document.querySelectorAll('.linea');
          lineas.forEach( ( e ) => {
            e.children[1].innerHTML = '';
          });
          let stop = document.createElement('button');
          stop.innerHTML = 'Parar';
          escenario.appendChild( stop );
          stop.addEventListener( 'click', () => {
            socket.emit( 'stop', pid );
          });
        };

        const rellenarTD = function() {
          let lineas = document.querySelectorAll('.linea');
          lineas.forEach( ( e ) => {
            e.children[1].innerHTML = '';
            const escenario = e.children[0].innerHTML;
            let enlace = document.createElement( 'a' );
            enlace.href = `app/visor/${escenario}`;
            enlace.title = escenario;
            enlace.target = '_blank';
            enlace.innerHTML = 'Iniciar';
            e.children[1].appendChild( enlace );
          });
        };

        socket.on( 'onload', ( p ) => {
          if ( p.proyector ) {
            escenarioActivo( p.escenario, p.pid );
          } else {
            rellenarTD();
          }
        });

        socket.on( 'out', (  ) => {
          rellenarTD();
        });

        socket.on( 'opened', ( elem ) => {
          socket.emit('sendPID', elem.pid);
          escenarioActivo( elem.escenario, elem.pid );
        });
  </script>
  <body>

  <div class="lista">
    <table class="escenarios">
      <tr>
        <th>Escenario</th>
        <th>Estado</th>
      </tr>
      
        {{#each datos}}
      <tr class="linea">
        <td>{{this.name}}</td>
        <td id={{this.name}}>
        </td>
      </tr>
        {{/each}}
    </table>
  </div>

  </body>

</html>
